<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>YourBrand - WhatsApp Group Extractor</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:Inter,Arial,sans-serif;max-width:900px;margin:24px auto;padding:18px}
    input,textarea,button{width:100%;padding:10px;margin-top:8px;box-sizing:border-box}
    header{display:flex;justify-content:space-between;align-items:center}
    .muted{color:#666;font-size:14px}
    .small{font-size:13px}
    .card{border:1px solid #eee;padding:14px;border-radius:8px;margin-top:12px}
  </style>
</head>
<body>
  <header>
    <h2>YourBrand - WhatsApp Group Extractor</h2>
  </header>

  <p class="muted">Paste the WhatsApp group link below and click Request Extraction. We'll process it and you'll get the results here and in your Google Sheet when ready.</p>

  <div class="card">
    <label class="small">Your name (optional)</label>
    <input id="clientName" placeholder="Client or company name" />

    <label class="small">Group link (paste)</label>
    <input id="groupLink" placeholder="https://chat.whatsapp.com/xxxx" />

    <label class="small">Callback webhook (optional) â€” we will POST results here</label>
    <input id="callback" placeholder="https://example.com/webhook/receive-results" />

    <button id="submit">Request Extraction</button>

    <p id="status" class="muted"></p>
  </div>

  <div class="card">
    <h3>Results (when ready)</h3>
    <p class="muted">Operator will paste the CSV here after extraction. Client can download the list.</p>
    <textarea id="results" rows="10" placeholder="Waiting for results..." readonly></textarea>
    <p><button id="download">Download CSV</button></p>
  </div>

  <script>
    // === EDIT THIS: paste your n8n "request-extract" webhook URL below ===
    const REQUEST_WEBHOOK = "PASTE_YOUR_N8N_REQUEST_WEBHOOK_HERE";
    // =====================================================================

    document.getElementById('submit').addEventListener('click', async () => {
      const name = document.getElementById('clientName').value.trim();
      const link = document.getElementById('groupLink').value.trim();
      const callback = document.getElementById('callback').value.trim();
      if(!link){ alert('Paste group link'); return }
      if(!REQUEST_WEBHOOK || REQUEST_WEBHOOK.includes("PASTE_YOUR")) {
        alert('Set REQUEST_WEBHOOK inside the HTML before using.');
        return;
      }
      document.getElementById('status').innerText = 'Sending request...'

      const payload = { clientName: name, groupLink: link, callback }
      try{
        const r = await fetch(REQUEST_WEBHOOK, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload) })
        if(!r.ok) throw new Error('Webhook error '+r.status)
        document.getElementById('status').innerText = 'Request sent. We will notify you when ready.'
      }catch(err){ document.getElementById('status').innerText = 'Error: '+err.message }
    })

    // download handler
    document.getElementById('download').addEventListener('click', ()=>{
      const text = document.getElementById('results').value;
      if(!text) return alert('No results yet');
      const blob = new Blob([text], { type:'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'phones.csv'; a.click(); URL.revokeObjectURL(url);
    })

    // Operator support: if operator pastes results into the "results" textarea,
    // the client can download them. For real automation the operator should POST
    // to the n8n receive-results webhook (see n8n_receive_results.json).
  </script>
</body>
</html>
