{
  "name": "Receive Extracted Phones -> Save & Notify",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "receive-results"
      },
      "id": "Webhook",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        260,
        300
      ]
    },
    {
      "parameters": {
        "functionCode": "const phones = items[0].json.phones || [];\nconst groupLink = items[0].json.groupLink || '';\nconst clientName = items[0].json.clientName || '';\nconst clientEmail = items[0].json.clientEmail || '';\nconst callback = items[0].json.callback || '';\nconst now = new Date().toISOString();\nreturn phones.map(p => ({ json: { phone: p, groupLink, clientName, clientEmail, callback, addedAt: now } }));"
      },
      "id": "Prepare",
      "name": "Prepare Rows",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        520,
        300
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "sheetId": "YOUR_CLIENT_SHEET_ID",
        "range": "Sheet1!A:F",
        "options": {
          "valueInputMode": "USER_ENTERED"
        }
      },
      "id": "GSheets",
      "name": "Append to Client Sheet",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 1,
      "position": [
        800,
        300
      ]
    },
    {
      "parameters": {
        "fromEmail": "noreply@yourbrand.com",
        "toEmail": "={{$json[\"clientEmail\"] || \"client@example.com\"}}",
        "subject": "Your extracted WhatsApp numbers are ready",
        "text": "Hi {{$json[\"clientName\"] || ''}},\n\nYour number extraction is complete. All phone numbers have been appended to your Google Sheet.\n\nIf you provided a callback URL, we have also attempted to POST the full JSON results to that endpoint.\n\nThank you."
      },
      "id": "EmailNotify",
      "name": "Notify Client (Email)",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 1,
      "position": [
        1060,
        300
      ]
    },
    {
      "parameters": {
        "url": "={{$json[\"callback\"]}}",
        "options": {},
        "allowUnauthorizedCerts": true
      },
      "id": "Callback",
      "name": "Callback POST",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        1060,
        520
      ],
      "disabled": false
    },
    {
      "parameters": {
        "functionCode": "return [{ json: { ok: true } }];"
      },
      "id": "Response",
      "name": "Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        1300,
        300
      ]
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Prepare",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare": {
      "main": [
        [
          {
            "node": "Append to Client Sheet",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Callback POST",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append to Client Sheet": {
      "main": [
        [
          {
            "node": "Notify Client (Email)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notify Client (Email)": {
      "main": [
        [
          {
            "node": "Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}
